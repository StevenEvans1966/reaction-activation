{"name":"Absorb Elements","type":"spell","img":"icons/magic/defensive/shield-barrier-flaming-diamond-red.webp","effects":[{"label":"Absorb Elements Reaction","icon":"icons/magic/defensive/shield-barrier-flaming-diamond-red.webp","origin":"Actor.0iTls3GFMkwYpoWX.Item.loePBQyN9ekqgV5a","duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"Yb8JK5DRhNOjYvkf","changes":[{"key":"flags.midi-qol.reactionHooks","mode":0,"value":"{\"damageTypes\":[\"acid\", \"cold\", \"fire\", \"lightning\", \"thunder\"]}","priority":20}],"tint":null,"transfer":true,"flags":{"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""},"ActiveAuras":{"isAura":false,"aura":"None","radius":"undefined","alignment":"","type":"","ignoreSelf":false,"height":false,"hidden":false,"displayTemp":false,"hostile":false,"onlyOnce":false},"dfreds-convenient-effects":{"description":""}}},{"_id":"1FZSW8SGDJQszAVq","flags":{"dae":{"stackable":"none","macroRepeat":"none","transfer":false,"specialDuration":["DamageDealt"],"selfTarget":false,"durationExpression":""},"ActiveAuras":{"isAura":false,"ignoreSelf":false,"hidden":false,"height":false,"alignment":"","type":"","aura":"None","radius":null,"save":"","savedc":null,"hostile":false,"onlyOnce":false,"time":"None"},"core":{"statusId":"","sourceId":"Item.fs45iEi4VlhWV4Bp.ActiveEffect.iJ9E4fnIwXjfi1TP"},"dnd5e-helpers":{"rest-effect":"Ignore"},"times-up":{"isPassive":false}},"changes":[{"key":"system.bonuses.msak.damage","mode":0,"value":"0","priority":20},{"key":"system.bonuses.mwak.damage","mode":0,"value":"0","priority":20}],"disabled":false,"duration":{"startTime":null,"rounds":2,"startTurn":1,"seconds":null,"combat":null,"turns":null,"startRound":null},"icon":"icons/magic/defensive/shield-barrier-flaming-diamond-red.webp","label":"Absorb Elements","tint":null,"transfer":false,"origin":"Item.qhipTj0RNhpTwEf3"},{"_id":"jJrt3P92lDaipoiS","changes":[{"key":"system.traits.dr.value","mode":2,"value":"fire","priority":20}],"disabled":false,"duration":{"rounds":2,"startTime":null,"seconds":null,"combat":null,"turns":null,"startRound":null,"startTurn":null},"icon":"icons/magic/defensive/shield-barrier-flaming-diamond-red.webp","label":"Absorb Elements Resistance","origin":"Item.qhipTj0RNhpTwEf3","transfer":false,"flags":{"dae":{"stackable":"none","macroRepeat":"none","specialDuration":["turnEnd"],"transfer":false},"dnd5e-helpers":{"rest-effect":"Ignore"},"ActiveAuras":{"isAura":false,"aura":"None","radius":null,"alignment":"","type":"","ignoreSelf":false,"height":false,"hidden":false,"hostile":false,"onlyOnce":false},"core":{"statusId":"","sourceId":"Item.fs45iEi4VlhWV4Bp.ActiveEffect.8r9eWcqP6QyIbPWU"},"times-up":{"isPassive":false}},"tint":null}],"flags":{"dynamiceffects":{"equipActive":[true,true,true],"alwaysActive":[true,true,true]},"mess":{"templateTexture":""},"dae":{"activeEquipped":false,"alwaysActive":false},"exportSource":{"world":"waterdeep-dungeon-of-the-mad-mage","system":"dnd5e","coreVersion":"0.7.9","systemVersion":"1.2.4"},"betterRolls5e":{"quickDesc":{"type":"Boolean","value":true,"altValue":true},"quickAttack":{"type":"Boolean","value":true,"altValue":true},"quickSave":{"type":"Boolean","value":true,"altValue":true},"quickDamage":{"type":"Array","value":[],"altValue":[],"context":[]},"quickVersatile":{"type":"Boolean","value":false,"altValue":false},"quickProperties":{"type":"Boolean","value":true,"altValue":true},"quickCharges":{"type":"Boolean","value":{"use":false,"resource":true},"altValue":{"use":false,"resource":true}},"quickTemplate":{"type":"Boolean","value":true,"altValue":true},"quickOther":{"type":"Boolean","value":true,"altValue":true,"context":""},"quickFlavor":{"type":"Boolean","value":true,"altValue":true},"quickPrompt":{"type":"Boolean","value":false,"altValue":false}},"itemacro":{"macro":{"data":{"_id":null,"name":"Absorb Elements","type":"script","author":"devnIbfBHb74U9Zv","img":"icons/svg/dice-target.svg","scope":"global","command":"let tactor;\nlet itemname = \"Absorb Elements\";\nif (args[0].tokenUuid) tactor = (await fromUuid(args[0].tokenUuid)).actor;\nelse tactor = game.actors.get(args[0].actorId);\n\nlet dialog = new Promise((resolve, reject) => {\nnew Dialog({\ntitle:'Choose a damage type',\ncontent:`\n  <form class=\"flexcol\">\n<div class=\"form-group\">\n  <select id=\"element\">\n<option value=\"acid\">Acid</option>\n<option value=\"cold\">Cold</option>\n<option value=\"fire\">Fire</option>\n<option value=\"lightning\">Lightning</option>\n<option value=\"thunder\">Thunder</option>\n  </select>\n</div>\n  </form>\n`,\n//select element type\nbuttons:{\nyes:{\nicon:'<i class=\"fas fa-bolt\"></i>',\nlabel:'Select',\ncallback:async (html) => {\nlet element = html.find('#element').val();\nlet effect =  tactor.effects.find(i => i.data.label === itemname);\nlet changes = duplicate(effect.data.changes);\nchanges[0].value = `${args[0].spellLevel}d6[${element}]`;\nchanges[1].value = `${args[0].spellLevel}d6[${element}]`;\nawait effect.update({changes});\neffect =  tactor.effects.find(i => i.data.label === `${itemname} Resistance`);\nchanges = duplicate(effect.data.changes);\nchanges[0].value = element;\nawait effect.update({changes});\nresolve();\n},\n},\n}\n}).render(true);\n})\nawait dialog;","folder":null,"sort":0,"permission":{"default":0},"flags":{}},"name":"Absorb Elements","type":"script","img":"icons/svg/dice-target.svg","scope":"global","command":"","sort":0,"ownership":{"default":0},"flags":{},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null},"author":"OOTaP8MEW43RjlP3","_id":null,"folder":null}},"midi-qol":{"onUseMacroName":"[postActiveEffects]function.ReactionActivation.macros.absorbElements","effectActivation":false,"reactionActivationData":{"hookId":341,"trigeringDamageTypes":["acid","cold","fire","lightning","thunder"]}},"core":{"sourceId":"Item.jwe2NqmH3YX6SMVx"},"favtab":{"isFavorite":false},"cf":{"id":"temp_pjad4yqna4p","color":"#000000"},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":true,"concentration":false,"toggleEffect":false,"autoFailFriendly":false,"autoSaveFriendly":false,"offHandWeapon":false,"ignoreTotalCover":false}},"system":{"description":{"value":"<div class=\"rd__b  rd__b--3\"><p>The spell captures some of the incoming energy, lessening its effect on you and storing it for your next melee attack. You have resistance to the triggering damage type until the start of your next turn. Also, the first time you hit with a melee attack on your next turn, the target takes an extra [[/r 1d6]] damage of the triggering type, and the spell ends.</p><div class=\"rd__spc-inline-post\"><p></p></div></div><div class=\"rd__b  rd__b--3\"><div class=\"rd__b  rd__b--3\"><p><span class=\"entry-title-inner\">At Higher Levels.</span></p><p>When you cast this spell using a spell slot of 2nd level or higher, the extra damage increases by [[/r 1d6]] for each slot level above 1st.</p></div></div>","chat":"","unidentified":""},"source":"XGE, RA 1.0.3","activation":{"type":"reactiondamage","cost":1,"condition":"which you take when you take acid, cold, fire, lightning, or thunder damage"},"duration":{"value":"1","units":"round"},"cover":null,"target":{"value":null,"width":null,"units":"","type":"self"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":0,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":1,"school":"abj","components":{"vocal":false,"somatic":true,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":"1d6"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1661995926181,"modifiedTime":1681399328648,"lastModifiedBy":"OOTaP8MEW43RjlP3"},"_id":"Ddi1ZvNXFjklF9tS","folder":null,"sort":0,"ownership":{"default":0,"OOTaP8MEW43RjlP3":3}}
{"name":"Absorb Elements (with item macro)","type":"spell","img":"icons/magic/defensive/shield-barrier-flaming-diamond-red.webp","effects":[{"label":"Absorb Elements Reaction","icon":"icons/magic/defensive/shield-barrier-flaming-diamond-red.webp","origin":"Actor.0iTls3GFMkwYpoWX.Item.loePBQyN9ekqgV5a","duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"Yb8JK5DRhNOjYvkf","changes":[{"key":"macro.itemMacro","mode":0,"value":"ItemMacro","priority":20},{"key":"flags.midi-qol.reactionHooks","mode":0,"value":"{\"damageTypes\":[\"acid\", \"cold\", \"fire\", \"lightning\", \"thunder\"]}","priority":20}],"tint":null,"transfer":true,"flags":{"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""},"ActiveAuras":{"isAura":false,"aura":"None","radius":"undefined","alignment":"","type":"","ignoreSelf":false,"height":false,"hidden":false,"displayTemp":false,"hostile":false,"onlyOnce":false}}},{"_id":"1FZSW8SGDJQszAVq","flags":{"dae":{"stackable":"none","macroRepeat":"none","transfer":false,"specialDuration":["DamageDealt"],"selfTarget":false,"durationExpression":""},"ActiveAuras":{"isAura":false,"ignoreSelf":false,"hidden":false,"height":false,"alignment":"","type":"","aura":"None","radius":null,"save":"","savedc":null,"hostile":false,"onlyOnce":false,"time":"None"},"core":{"statusId":"","sourceId":"Item.fs45iEi4VlhWV4Bp.ActiveEffect.iJ9E4fnIwXjfi1TP"},"dnd5e-helpers":{"rest-effect":"Ignore"},"times-up":{"isPassive":false}},"changes":[{"key":"system.bonuses.msak.damage","mode":0,"value":"0","priority":20},{"key":"system.bonuses.mwak.damage","mode":0,"value":"0","priority":20}],"disabled":false,"duration":{"startTime":null,"rounds":2,"startTurn":1,"seconds":null,"combat":null,"turns":null,"startRound":null},"icon":"icons/magic/defensive/shield-barrier-flaming-diamond-red.webp","label":"Absorb Elements","tint":null,"transfer":false,"origin":"Item.qhipTj0RNhpTwEf3"},{"_id":"jJrt3P92lDaipoiS","changes":[{"key":"system.traits.dr.value","mode":2,"value":"fire","priority":20}],"disabled":false,"duration":{"rounds":2,"startTime":null,"seconds":null,"combat":null,"turns":null,"startRound":null,"startTurn":null},"icon":"icons/magic/defensive/shield-barrier-flaming-diamond-red.webp","label":"Absorb Elements Resistance","origin":"Item.qhipTj0RNhpTwEf3","transfer":false,"flags":{"dae":{"stackable":"none","macroRepeat":"none","specialDuration":["turnEnd"],"transfer":false},"dnd5e-helpers":{"rest-effect":"Ignore"},"ActiveAuras":{"isAura":false,"aura":"None","radius":null,"alignment":"","type":"","ignoreSelf":false,"height":false,"hidden":false,"hostile":false,"onlyOnce":false},"core":{"statusId":"","sourceId":"Item.fs45iEi4VlhWV4Bp.ActiveEffect.8r9eWcqP6QyIbPWU"},"times-up":{"isPassive":false}},"tint":null}],"flags":{"dynamiceffects":{"equipActive":[true,true,true],"alwaysActive":[true,true,true]},"mess":{"templateTexture":""},"dae":{"activeEquipped":false,"alwaysActive":false},"exportSource":{"world":"waterdeep-dungeon-of-the-mad-mage","system":"dnd5e","coreVersion":"0.7.9","systemVersion":"1.2.4"},"betterRolls5e":{"quickDesc":{"type":"Boolean","value":true,"altValue":true},"quickAttack":{"type":"Boolean","value":true,"altValue":true},"quickSave":{"type":"Boolean","value":true,"altValue":true},"quickDamage":{"type":"Array","value":[],"altValue":[],"context":[]},"quickVersatile":{"type":"Boolean","value":false,"altValue":false},"quickProperties":{"type":"Boolean","value":true,"altValue":true},"quickCharges":{"type":"Boolean","value":{"use":false,"resource":true},"altValue":{"use":false,"resource":true}},"quickTemplate":{"type":"Boolean","value":true,"altValue":true},"quickOther":{"type":"Boolean","value":true,"altValue":true,"context":""},"quickFlavor":{"type":"Boolean","value":true,"altValue":true},"quickPrompt":{"type":"Boolean","value":false,"altValue":false}},"itemacro":{"macro":{"data":{"_id":null,"name":"Absorb Elements","type":"script","author":"devnIbfBHb74U9Zv","img":"icons/svg/dice-target.svg","scope":"global","command":"let tactor;\nlet itemname = \"Absorb Elements\";\nif (args[0].tokenUuid) tactor = (await fromUuid(args[0].tokenUuid)).actor;\nelse tactor = game.actors.get(args[0].actorId);\n\nlet dialog = new Promise((resolve, reject) => {\nnew Dialog({\ntitle:'Choose a damage type',\ncontent:`\n  <form class=\"flexcol\">\n<div class=\"form-group\">\n  <select id=\"element\">\n<option value=\"acid\">Acid</option>\n<option value=\"cold\">Cold</option>\n<option value=\"fire\">Fire</option>\n<option value=\"lightning\">Lightning</option>\n<option value=\"thunder\">Thunder</option>\n  </select>\n</div>\n  </form>\n`,\n//select element type\nbuttons:{\nyes:{\nicon:'<i class=\"fas fa-bolt\"></i>',\nlabel:'Select',\ncallback:async (html) => {\nlet element = html.find('#element').val();\nlet effect =  tactor.effects.find(i => i.data.label === itemname);\nlet changes = duplicate(effect.data.changes);\nchanges[0].value = `${args[0].spellLevel}d6[${element}]`;\nchanges[1].value = `${args[0].spellLevel}d6[${element}]`;\nawait effect.update({changes});\neffect =  tactor.effects.find(i => i.data.label === `${itemname} Resistance`);\nchanges = duplicate(effect.data.changes);\nchanges[0].value = element;\nawait effect.update({changes});\nresolve();\n},\n},\n}\n}).render(true);\n})\nawait dialog;","folder":null,"sort":0,"permission":{"default":0},"flags":{}},"name":"Absorb Elements","type":"script","img":"icons/svg/dice-target.svg","scope":"global","command":"const version = \"1.0.3\";\n\nconst lastArg = args[args.length - 1];\n\ntry {\n    if (args[0] === \"off\") {\n        await ReactionActivation.removeReactionActivation(lastArg.origin)\n        return;\n    }\n} catch (err) {\n    console.error(`Absorb Elements Off ${version}`, err);\n}\n\ntry {\n    if (args[0].tag === \"OnUse\" && args[0].macroPass === \"postActiveEffects\") {\n        let tactor = (args[0].tokenUuid) ? (await fromUuid(args[0].tokenUuid)).actor : game.actors.get(args[0].actorId);\n        let item = args[0].item\n\n        let dialogRtn = await ReactionActivation.getDamageTypeForReaction(args[0].workflowOptions, item)\n\n        const chatMessage = game.messages.get(args[0].itemCardId);\n        var content = duplicate(chatMessage.content);\n        content = content.substring(0, content.length - 6)\n        content += `<div class=\"card-header flexrow\">\n        <img src=\"${dialogRtn.nameAndIcon.img}\" width=\"34\" height=\"34\" style=\"border:0px;vertical-align: bottom;\"/>\n        <h3>Absorbed ${dialogRtn.nameAndIcon.name}</h3>\n        </div></div>`\n        chatMessage.update({ content: content })\n\n        const itemName = item.name;\n        const damageType = dialogRtn.damageType\n        let effect = tactor.effects.find(i => i.label === itemName);\n        let changes = duplicate(effect.changes);\n        changes[0].value = `${args[0].spellLevel}d6[${damageType}]`;\n        changes[1].value = `${args[0].spellLevel}d6[${damageType}]`;\n        await effect.update({ changes });\n        effect = tactor.effects.find(i => i.label === `${itemName} Resistance`);\n        changes = duplicate(effect.changes);\n        changes[0].value = damageType;\n        await effect.update({ changes });\n    }\n} catch (err) {\n    console.error(`Absorb Elements OnUse ${version}`, err);\n}","sort":0,"ownership":{"default":0},"flags":{},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null},"author":"OOTaP8MEW43RjlP3","_id":null,"folder":null}},"midi-qol":{"onUseMacroName":"[postActiveEffects]ItemMacro","effectActivation":false,"reactionActivationData":{"hookId":341,"trigeringDamageTypes":["acid","cold","fire","lightning","thunder"]}},"core":{"sourceId":"Item.jwe2NqmH3YX6SMVx"},"favtab":{"isFavorite":false},"cf":{"id":"temp_pjad4yqna4p","color":"#000000"},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":true,"concentration":false,"toggleEffect":false,"autoFailFriendly":false,"autoSaveFriendly":false,"offHandWeapon":false,"ignoreTotalCover":false}},"system":{"description":{"value":"<div class=\"rd__b  rd__b--3\"><p>The spell captures some of the incoming energy, lessening its effect on you and storing it for your next melee attack. You have resistance to the triggering damage type until the start of your next turn. Also, the first time you hit with a melee attack on your next turn, the target takes an extra [[/r 1d6]] damage of the triggering type, and the spell ends.</p><div class=\"rd__spc-inline-post\"><p></p></div></div><div class=\"rd__b  rd__b--3\"><div class=\"rd__b  rd__b--3\"><p><span class=\"entry-title-inner\">At Higher Levels.</span></p><p>When you cast this spell using a spell slot of 2nd level or higher, the extra damage increases by [[/r 1d6]] for each slot level above 1st.</p></div></div>","chat":"","unidentified":""},"source":"XGE, RA 1.0.3","activation":{"type":"reactiondamage","cost":1,"condition":"which you take when you take acid, cold, fire, lightning, or thunder damage"},"duration":{"value":"1","units":"round"},"cover":null,"target":{"value":null,"width":null,"units":"","type":"self"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":0,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":1,"school":"abj","components":{"vocal":false,"somatic":true,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":"1d6"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1661995926181,"modifiedTime":1681399328646,"lastModifiedBy":"OOTaP8MEW43RjlP3"},"_id":"ugfOaLlAJe6H11Or","folder":null,"sort":0,"ownership":{"default":0,"OOTaP8MEW43RjlP3":3}}
